<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Karma Dashbord</title>
    <link rel="shortcut icon" href="/img/fav.png" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
    <link rel="stylesheet" href="/adminpublic/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/adminpublic/css/templatemo-style.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap4.min.css" />
    
    
<style>
    .offer-section {
      background-color: #435c70;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 10px;
    }
    .offer-section h2 {
      color: #fff;
      margin-bottom: 20px;
    }
    .offer-form {
      background-color: #4e657a;
      padding: 20px;
      border-radius: 5px;
    }
    .offer-form label {
      color: #fff;
    }
    .offer-form input,
    .offer-form select {
      margin-bottom: 10px;
    }
    .offer-list {
      background-color: #4e657a;
      padding: 20px;
      border-radius: 5px;
      margin-top: 20px;
    }
    .offer-list table {
      color: #fff;
    }
    .btn-add-offer {
      margin-bottom: 20px;
    }
  </style>
    <style>
        .product-image { max-width: 100px; height: auto; }
        .action-buttons .btn { margin-bottom: 5px; }
    </style>
    <style>
        .modal-content {
          background-color: #435c70;
          color: #fff;
        }
        .modal-header {
          border-bottom: 1px solid #4e657a;
        }
        .modal-footer {
          border-top: 1px solid #4e657a;
        }
        .form-control {
          background-color: #4e657a;
          color: #fff;
          border: 1px solid #6c7fa1;
        }
        .form-control:focus {
          background-color: #4e657a;
          color: #fff;
        }
      </style>
</head>
<body>
    <%- include('../admin-partials/header'); %>

    <div class="container mt-5" style="padding-bottom: 50px">
        <h2 class="tm-block-title">Category Offer List</h2>
        <div class="row mb-4">
                <button
                  class="btn btn-primary btn-add-offer"
                  data-toggle="modal"
                  data-target="#referralOfferModal"
                >
                <i class="fas fa-plus"></i> Add Category Offer
                </button>
        </div>
        <div class="table-responsive">
            <table id="productsTable" class="table table-hover">
                <thead class="thead-dark">
                    <tr>
                        <th>NO</th>
                        <th>CATEGORY NAME</th>
                        <th>STATUS</th>
                        <th>OFFER PRICE</th>
                        <th>EXPIRY DATE</th>
                        <th>ACTION</th>
                    </tr>
                </thead>
                <tbody>
                    <% if (offerCategorys && offerCategorys.length > 0) { %>
                        <% offerCategorys.forEach((category,idx) => { %>
                                <tr>
                                    <th><%= idx+1 %></th>
                                    <td><%= category. category_id.name %></td>
                                    <td><%= category.name %></td>
                                    <td><%= category.offerPercentage %></td>
                                    <td><%= category.expiryDate.toDateString() %></td>
                                    <td>
                                        <% if (category.isActive) { %>
                                        <a class="btn btn-danger btn-sm deleteAction" onclick="deleteProduct('<%= category._id %>')">
                                            <i class="far fa-trash-alt"></i>
                                        </a>
                                        <% } else {%>
                                            <a class="btn btn-success btn-sm recoverAction" onclick="recoverProduct('<%= category._id %>')">
                                                <i class="fas fa-undo-alt"></i>
                                            </a>
                                            <%}%>
                                        <a href="/admin/edit-product/<%= category._id %>" class="btn btn-primary btn-sm">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                    </td>
                                </tr>
                        <% }) %>
                    <% } else { %>
                        <tr>
                            <td colspan="9" class="text-center">No products in the database</td>
                        </tr>
                    <% } %>
                </tbody>
            </table>
        </div>
    </div>

    <!-- modal  -->
    <div
    class="modal fade"
    id="referralOfferModal"
    tabindex="-1"
    role="dialog"
    aria-labelledby="referralOfferModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title text-dark" id="referralOfferModalLabel">
            Add Category Offer
          </h5>
          <button
            type="button"
            class="close"
            data-dismiss="modal"
            aria-label="Close"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="categorylOfferForm" class="offer-form" action="/admin/add-new-category-offer" method="post">
            <div class="form-group">
              <label for="categoryDiscount">Discount in percentage</label>
              <input
                type="number"
                class="form-control text-dark"
                id="referralDiscount"
                name="offerPercentage"
                placeholder="Discount in percentage"
                style="background-color: #fff;"
                required
              />
              <label for="selectCategory">Select Category</label>
              <select  class="form-control text-dark" name="category_id" style="background-color: #fff;">
                <%categorys.forEach((category)=>{ %>
                    <option value="<%=category._id%>"><%=category.name%></option>    
                <% }) %>
              </select>
              <label for="referralDiscount">ExpiryDate</label>
              <input type="date"
              name="expiryDate"
                class="form-control text-dark"
                id="referralDiscount"
                style="background-color: #fff;"
                required>
            </div>
            <div>
              <button type="submit" class="btn btn-primary text-dark">
                Add Discount
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

    <%- include('../admin-partials/footer'); %>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="/adminpublic/js/bootstrap.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        $(document).ready(function() {
            $('#productsTable').DataTable({
                "pageLength": 10,
                "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                "order": [[ 7, "desc" ]],  // Sort by Added Date column descending
                "language": {
                    "search": "Search products:"
                }
            });
        });

        function deleteProduct(productId) {
            Swal.fire({
                title: 'Do you want to delete this product?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'OK',
            }).then(async (result) => {
                if (result.isConfirmed) {
                    const response = await fetch(`/admin/delete-product/${productId}`, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                    });

                    if (response.ok) {
                        window.location.href = '/admin/products';
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            text: 'Something went wrong!',
                        });
                    }
                }
            });
        }

        // function recoverProduct(productId) {
        //     Swal.fire({
        //         title: 'Do you want to recover this product?',
        //         icon: 'warning',
        //         showCancelButton: true,
        //         confirmButtonColor: '#3085d6',
        //         confirmButtonText: 'OK',
        //     }).then(async (result) => {
        //         if (result.isConfirmed) {
        //             const response = await fetch(`/admin/recover-product/${productId}`, {
        //                 method: 'PATCH',
        //                 headers: {
        //                     'Content-Type': 'application/json',
        //                 },
        //             });

        //             if (response.ok) {
        //                 window.location.reload();
        //             } else {
        //                 Swal.fire({
        //                     icon: 'error',
        //                     title: 'Oops...',
        //                     text: 'Something went wrong!',
        //                 });
        //             }
        //         }
        //     });
        // }
   
   </script>
</body>
</html>