<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Dashboard</title>
    <link rel="shortcut icon" href="/img/fav.png" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
      integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="stylesheet" href="/adminpublic/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/adminpublic/css/templatemo-style.css" />
    <link rel="stylesheet" href="/adminpublic/css/fontawesome.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="/adminpublic/cropper/cropper.min.css" />
    <style>
      .nav-link.active {
        color: #ffffff !important;
      }
      .nav-link.active::after {
        content: "";
        display: block;
        width: 100%;
        height: 3px;
        background-color: #ffc107;
        position: absolute;
        bottom: 0;
        left: 0;
      }
      .nav-item {
        position: relative;
      }
      .input-group {
        width: 100%;
      }
      .btn {
        margin-bottom: 10px;
      }
      .product-image {
        max-width: 100px;
        height: auto;
      }
      .badge {
        font-size: 12px;
        padding: 6px 8px;
        border-radius: 4px;
      }
      .input-group input[type="text"] {
        color: #fff;
      }
      .action-buttons .btn {
        width: 100%;
      }
      @media (max-width: 768px) {
        .action-buttons .btn {
          margin-top: 10px;
        }
      }
    </style>
  </head>
  <body id="reportsPage">
    <nav class="navbar navbar-expand-xl">
      <div class="container h-100" style="margin: 20px">
        <button
          class="navbar-toggler ml-auto mr-0"
          type="button"
          data-toggle="collapse"
          data-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <i class="fas fa-bars tm-nav-icon"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav mx-auto h-100">
            <li class="nav-item">
              <a class="nav-link" href="/admin/dashboard">
                <i class="fas fa-tachometer-alt"></i> Dashboard
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/admin/products">
                <i class="fas fa-shopping-cart"></i> Products
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/admin/customers">
                <i class="far fa-user"></i> Customers
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/admin/categories-and-brand">
                <i class="fas fa-list"></i> Categories/Brand
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/admin/tags-and-size">
                <i class="fas fa-list"></i> Tags/Size
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/admin/orders">
                <i class="fas fa-truck"></i> Orders
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/admin/coupons">
                <i class="fas fa-tag"></i> Coupons
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/admin/banners">
                <i class="fas fa-image"></i> Banners
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/admin/payments">
                <i class="fas fa-money-bill-alt"></i> Payments
              </a>
            </li>
          </ul>
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link d-block" id="logout" style="cursor: pointer; color: #fff;">
                Admin, <b>Logout</b>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <div class="container mt-4">
      <div class="row">
        <div class="col-lg-12">
          <div class="cardHeader d-flex justify-content-between align-items-center">
            <h1><i>Dashboard</i></h1>
            <button type="button" data-bs-toggle="modal" data-bs-target="#staticBackdrop" class="btn btn-outline-success ml-auto">
              <b><i>Download Sales Report</i></b>
            </button>
          </div>
          <div class="card mb-4 shadow" style="background-color: #ddf0da;">
            <h2 class="card-header" style="background-color: rgb(175, 251, 158); border-radius: 10px;">
              Sales Analysis
            </h2>
            <div class="card-body">
              <div class="row">
                <div class="dropdown">
                  <button class="btn btn-outline-primary dropdown-toggle" type="button" id="timeIntervalDropdown" data-toggle="dropdown" aria-expanded="false">
                    <i>Filter</i>
                  </button>
                  <ul class="dropdown-menu bg-success btn-sm" aria-labelledby="timeIntervalDropdown">
                    <li><a class="dropdown-item" id="byDayOption">By Day</a></li>
                    <li><a class="dropdown-item" id="byMonthOption">By Month</a></li>
                    <li><a class="dropdown-item" id="byYearOption">By Year</a></li>
                  </ul>
                </div>
                <div class="col-lg-6">
                  <canvas id="salesGraphAmount" width="400" height="400"></canvas>
                </div>
                <div class="col-lg-6">
                  <canvas id="salesGraphCount" width="400" height="400"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-12">
          <div class="card mb-4 shadow" style="background-color: rgb(190, 239, 232)">
            <h2 class="card-header" style="background-color: rgb(123, 242, 240); border-radius: 10px;">
              Latest Orders
            </h2>
            <div class="card-body ">
              <div class="table-responsive">
                <table class="table table-borderless">
                  <thead id="latestOrdersTableHead">
                    <tr>
                      <th>Order ID</th>
                      <th>Date</th>
                      <th>Total</th>
                      <th>Payment</th>
                      <th>Status</th>
                    </tr>
                  </thead>
                  <tbody id="latestOrdersTable"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-12">
          <div class="card shadow" style="background-color: #ebcfcf;">
            <h2 class="card-header" style="background-color:#efadad; border-radius: 10px;">
              Best Sellers
            </h2>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-borderless">
                  <thead id="bestSellersTableHead">
                    <tr>
                      <th>Product Image</th>
                      <th>Product</th>
                      <th>Product Name</th>
                      <th>Price</th>
                      <th>Status</th>
                      <th>Sold</th>
                    </tr>
                  </thead>
                  <tbody id="bestSellersTable"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="downloadModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2>Download Sales Report</h2>
        <form id="downloadForm">
          <label for="reportType">Select Report Type:</label>
          <select id="reportType" name="reportType">
            <option value="day">Daily</option>
            <option value="month">Monthly</option>
            <option value="year">Yearly</option>
          </select>
          <br />
          <label for="reportFormat">Select Format:</label>
          <select id="reportFormat" name="reportFormat">
            <option value="pdf">PDF</option>
            <option value="csv">CSV</option>
            <option value="excel">Excel</option>
          </select>
          <br />
          <input type="submit" value="Download" />
        </form>
      </div>
    </div>
    <footer class="tm-footer row tm-mt-small">
      <div class="col-12 font-weight-light text-center">
        <p class="text-white mb-0">
          Copyright &copy; 2021 Company Name.
          All rights reserved.
        </p>
      </div>
    </footer>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="/adminpublic/js/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
    <script src="/adminpublic/js/bootstrap.bundle.min.js"></script>
    <script src="/adminpublic/js/custom.js"></script>
  </body>
</html>

    <!-- modal  -->
    <div id="downloadModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2>Download Sales Report</h2>
        <form id="downloadForm">
          <div class="form-group">
            <label for="startDate">Start Date:</label>
            <input type="date" id="startDate" name="startDate" required />
          </div>
          <div class="form-group">
            <label for="endDate">End Date:</label>
            <input type="date" id="endDate" name="endDate" required />
          </div>
          <div class="form-group">
            <label for="fileType">File Type:</label>
            <select id="fileType" name="fileType" required>
              <option value="">Select file type</option>
              <option value="excel">Excel</option>
              <option value="pdf">PDF</option>
              <option value="csv">CSV</option>
            </select>
          </div>
          <button type="submit" class="download-modal-btn">Download</button>
        </form>
      </div>
    </div>


    <script>
      function openModal() {
        document.getElementById("downloadModal").style.display = "block";
      }

      function closeModal() {
        document.getElementById("downloadModal").style.display = "none";
      }

      document
        .getElementById("downloadForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();
          const startingDate = document.getElementById("startDate").value;
          const endingDate = document.getElementById("endDate").value;
          const fileType = document.getElementById("fileType").value;

          if (!startingDate || !endingDate || !fileType) {
            showToast("Please fill in all fields", "error");
            return;
          }

          if (new Date(startingDate) > new Date(endingDate)) {
            showToast("Start date must be before end date", "error");
            return;
          }

          let url;
          let fileName;
          switch (fileType) {
            case "excel":
              url = "/admin/order-generate-excel";
              fileName = "sales_report.xlsx";
              break;
            case "pdf":
              url = "/admin/order-generate-pdf";
              fileName = "sales_report.pdf";
              break;
            case "csv":
              url = "/admin/order-generate-csv";
              fileName = "sales_report.csv";
              break;
          }

          try {
            const response = await fetch(url, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ startingDate, endingDate }),
            });

            if (response.ok) {
            showToast("Downloading...", "info");
              const blob = await response.blob();
              downloadFile(blob, fileName);
              closeModal();
            } else {
              showToast("Error occurred while downloading", "error");
            }
          } catch (error) {
            showToast("Network error occurred", "error");
          }
        });

      function downloadFile(blob, fileName) {
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.style.display = "none";
        a.href = url;
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
      }

      function showToast(message, type) {
        Toastify({
          text: message,
          duration: 3000,
          close: true,
          gravity: "top",
          position: "right",
          backgroundColor:
            type === "error"
              ? "#ff0000"
              : type === "info"
              ? "#0000ff"
              : "#4CAF50",
        }).showToast();
      }
    </script>



                                    <button type="button" data-bs-toggle="modal" data-bs-target="#staticBackdrop"
                                    class="btn btn-outline-success ml-auto"><b><i>Download Sales Report</i></b></button>